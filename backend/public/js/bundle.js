!function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}([function(e,t,o){},function(e,t,o){},function(e,t,o){"use strict";o.r(t);o(0),o(1);class n{constructor(){this.url="https://www.googleapis.com/books/v1/volumes?q="}async getFirstTen(){const e=await fetch(this.url+"subject:drama");return(await e.json()).items}async getVolume(e,t){const o=await fetch(""+(this.url+e+t));return(await o.json()).items}}const s=new n;const r=new class{constructor(){this.init()}init(){this.printInfo(),this.copyISBN()}printInfo(){document.querySelector("#title-favorites").textContent="";const e=document.querySelector("#books-cards");let t="";s.getFirstTen().then(o=>{o.map(e=>{const o=this.createBookCard(e.volumeInfo,"hidden","");t+=o}),e.innerHTML=t})}printSearchResult(e,t,o,n){document.querySelector("#title-favorites").textContent=""+t;const s=document.querySelector("#books-cards");this.cleanDiv(s);let r="";e.map(e=>{const t=this.createBookCard(e.volumeInfo,o,n);r+=t}),s.innerHTML=r}createBookCard(e,t,o){const{title:n,authors:s,publisher:r,averageRating:a,publishedDate:c,pageCount:i,categories:l,imageLinks:d,industryIdentifiers:u,infoLink:m}=e;return`<div class="card max-size d-inline-block mx-auto m-2 shadow">\n              <div class="card-body pt-2 pl-2 pr-2 pb-0 font-italic">\n                <div class="text-right">\n                <button class="btn btn-secondary btn-sm m-0 border-0 p-1" ${t} data-id="delete-btn" data-isbn="${u?u[0].identifier:""}"><i class="material-icons md-15">delete</i></button>\n                </div>\n                <div class="text-center">\n                  <img class="card-img w-30 shadow mx-auto" src="${d?d.smallThumbnail:"https://books.google.com.ar/googlebooks/images/no_cover_thumb.gif"}" title="${n}">\n                  <h5 class="card-title font-italic mt-3 mb-0"><b>${n}</b></h5>\n                  <p class="small mt-0 mb-1">${l?l.map(e=>e).join(" , "):""}</p>\n                  ${this.checkAverage(a)}\n                </div>\n                <hr class="m-0">\n                <ul class="pt-1 pr-3 pb-2 pl-3 m-0 text-secondary">\n                  <li><b>Autores</b>: ${s?s.map(e=>e).join(" , "):"Anonymous"}.</li>\n                  <li><b>Páginas</b>: ${i||" ? "}</li>\n                  <li><b>Editor</b>: ${r||"Unrecognized"}.</li>\n                  <li><b>Fecha</b>: ${c||"Without date"}</li>\n                </ul>\n                ${u?`<button class="btn btn-secondary btn-sm ml-1 mr-1 mb-1 text-left font-italic" ${o} data-clipboard-text="${u[0].identifier}" >Copiar isbn</button>`:`<button class="btn btn-warning btn-sm ml-1 mr-1 mb-1 text-left font-italic" ${o} title="Este libro no cuenta con ISBN!" disabled>sin isbn</button>`}\n                <a href="${m}" target="__blank" class="btn btn-secondary btn-sm float-right mr-1 mb-1">Más info</a>\n              </div>\n            </div>`}checkAverage(e){let t="";if(e){for(let o=1;o<=e;o++)t+='<i class="material-icons md-15">star</i>';!Number.isInteger(e)&&(t+='<i class="material-icons md-15">star_half</i>')}else t='<i class="material-icons md-15">star_border</i>';return t}showMessage(e,t,o,n){const s=document.querySelector("#text-search"),r=document.querySelector("#isbn-input");"message"===n?(s.value="",s.focus()):(r.value="",r.focus());const a=document.querySelector("#"+n);this.cleanDiv(a);const c=`<div class="alert ${t} shadow text-center" role="alert">\n                  <i class="material-icons md-17 ml-0 mr-1">${o}</i>\n                  ${e}.            \n                  </div>`;a.innerHTML+=c,setTimeout(()=>{this.cleanDiv(a)},3e3)}messageModal(e,t,o,n){const s=document.querySelector("#message-"+n);this.cleanDiv(s);const r=`<div class="alert ${t} text-center" role="alert">\n                      <h5><i class="material-icons md-17 mt-1 mb-1">${o}</i>\n                        ${e}.</h5>              \n                      </div>`;s.innerHTML+=r,setTimeout(()=>{this.cleanDiv(s)},2500)}closeModal(e){setTimeout(()=>{const t=document.querySelector("#modal-"+e);t.style.display="none",t.className="modal fade",document.querySelector(".modal-backdrop.fade.show").remove(),document.querySelector(".modal-open").removeAttribute("style"),document.querySelector(".modal-open").removeAttribute("class")},2500)}openModal(e){setTimeout(()=>{const t=document.querySelector("#modal-"+e);t.style.display="block",t.className="modal fade show";const o=document.querySelector("#body");o.insertAdjacentHTML("beforeend",'<div class="modal-backdrop fade show"></div>'),o.className="modal-open",o.style.paddingRight="17px"},3e3)}modifyNavbar(e){const t=document.querySelector("#navbar-btns");this.cleanDiv(t);const o=`<li>\n                    <div class="btn-group dropleft">\n                      <button type="button" class="btn btn-primary dropdown-toggle pt-1 pb-1" data-toggle="dropdown">\n                        ${e}\n                      </button>\n                      <div class="dropdown-menu shadow">\n                        <button class="dropdown-item" type="button" id="fav-btn">\n                        <i class="material-icons md-15 mr-1">favorite</i>Favoritos\n                        </button>\n                        <div class="dropdown-divider"></div>\n                        <button class="dropdown-item" type="button" id="logout-btn">\n                        <i class="material-icons md-15 mr-1">exit_to_app</i>Cerrar sesión\n                        </button>\n                      </div>\n                    </div>\n                    </li>`;t.innerHTML=o}removeCard(e){document.querySelector(`button[data-isbn="${e}"]`).parentElement.parentElement.parentElement.remove()}cleanDiv(e){for(;e.firstChild;)e.firstChild.remove()}cleanForm(e){document.querySelector("#"+e).reset()}copyISBN(){const e=new ClipboardJS(".btn");e.on("success",e=>{const t=e.text,o=e.trigger;o.classList.remove("btn-secondary"),o.classList.add("btn-success"),o.textContent="isbn copiado",setTimeout(()=>{o.classList.remove("btn-success"),o.classList.add("btn-secondary"),o.textContent="copiar isbn"},4e3),console.log("ISBN : ",t)}),e.on("error",e=>console.log("No funciona: ",e))}async pasteISBN(){const e=document.querySelector("#isbn-input"),t=await navigator.clipboard.readText();e.select(),e.value=t}signOff(){localStorage.removeItem("token"),location.reload()}},a=new n,c=new class{constructor(){this.url="http://localhost:4000/api/"}async getAuthentication(e){const t={method:"POST",body:e},o=await fetch(this.url+"users/login",t);return await o.json()}async createUser(e){const t={method:"POST",body:e},o=await fetch(this.url+"users/create",t);return await o.json()}async getCollectionBooks(){const e={headers:{Authorization:"Bearer "+localStorage.getItem("token")},method:"GET"},t=await fetch(this.url+"books/",e);return await t.json()}async saveBook(e){const t={headers:{Authorization:"Bearer "+localStorage.getItem("token")},method:"POST",body:e},o=await fetch(this.url+"books/add",t);return await o.json()}async deleteBook(e){const t={headers:{Authorization:"Bearer "+localStorage.getItem("token")},method:"DELETE"},o=await fetch(`${this.url}books/delete/${e}`,t);return await o.json()}},i=document.querySelector("#search-btn"),l=document.querySelector("#btn-login"),d=document.querySelector("#btn-register"),u=document.querySelector("#isbn-paste-btn"),m=document.querySelector("#save-btn");let b,g;i.addEventListener("click",e=>{e.preventDefault();const t=document.querySelector("#select-type-of-search"),o=t.options[t.selectedIndex].value,n=document.querySelector("#text-search").value;"0"===o||""===n?r.showMessage("Debes completar todos los campos","alert-danger","warning","message"):(r.showMessage("Obteniendo resultados...","alert-info","check_circle","message"),a.getVolume(o,n).then(e=>{e?r.printSearchResult(e,"Resultados de la búsqueda..","hidden",""):r.showMessage("No se encontraron resultados.","alert-danger","sentiment_very_dissatisfied","message")}).catch(e=>{throw e}))}),l.addEventListener("click",e=>{e.preventDefault();const t=document.querySelector("#username").value,o=document.querySelector("#password").value;if(""===t||""===o)r.messageModal("Debes completar los campos.","alert-danger","error","login");else{r.messageModal("Ingresando...","alert-primary","account_circle","login");const e=new FormData(document.querySelector("#login-form"));c.getAuthentication(e).then(e=>{const{message:o,token:n}=e;r.messageModal(""+o,"alert-success","verified_user","login"),r.cleanForm("login-form"),localStorage.setItem("token",n),r.modifyNavbar(t),m.removeAttribute("disabled"),r.closeModal("login"),b=document.querySelector("#fav-btn").addEventListener("click",()=>{let e=[];c.getCollectionBooks().then(async t=>{if(0===t.length){document.querySelector("#title-favorites").textContent="Aún no hay libros guardados";const e=document.querySelector("#books-cards");r.cleanDiv(e)}else{for(let o of t){const t=await a.getVolume("isbn:",o.isbn);e.push(t[0])}r.printSearchResult(e,"Mis favoritos","","hidden"),Array.from(document.querySelectorAll('[data-id="delete-btn"]')).map(e=>{e.addEventListener("click",()=>{const t=e.dataset.isbn;r.removeCard(t),c.deleteBook(t).then(e=>{r.showMessage(""+e.message,"alert-warning","feedback","message-save-book")}).catch(e=>{throw e})})})}}).catch(e=>{throw e})}),g=document.querySelector("#logout-btn").addEventListener("click",()=>{r.signOff()})}).catch(e=>{throw e})}}),d.addEventListener("click",e=>{e.preventDefault();const t=document.querySelector("#new_username").value,o=document.querySelector("#new_email").value,n=document.querySelector("#new_password").value;if(""===t||""===o||""===n)r.messageModal("Debes completar los campos.","alert-danger","error","register");else{r.messageModal("Creando nuevo usuario","alert-info","account_circle","register");const e=new FormData(document.querySelector("#register-form"));c.createUser(e).then(e=>{r.messageModal(""+e.message,"alert-success","done","register"),r.cleanForm("register-form"),r.closeModal("register"),r.openModal("login")})}}),u.addEventListener("click",()=>r.pasteISBN()),m.addEventListener("click",e=>{if(e.preventDefault(),""===document.querySelector("#isbn-input").value)r.showMessage("Debes ingresar el ISBN del libro a guardar","alert-danger","error","message-save-book");else{const e=new FormData(document.querySelector("#save-book-form"));c.saveBook(e).then(e=>{r.showMessage(""+e.message,"alert-success","done","message-save-book"),r.cleanForm("save-book-form")})}})}]);